{% extends 'base.html.twig' %}

{% block title %}Réservation - Étape 2 - Dèmè Travel{% endblock %}

{% block body %}
<div class="reservation-page">
    <div class="page-header">
        <h1>📋 Réservation - Étape 2</h1>
        <p>Récapitulatif de votre sélection</p>
    </div>

    <!-- Progression -->
    <div class="progress-bar">
        <div class="progress-step completed">
            <div class="step-number">✓</div>
            <div class="step-label">Choisir</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step active">
            <div class="step-number">2</div>
            <div class="step-label">Pèlerins</div>
        </div>
        <div class="progress-line"></div>
        <div class="progress-step">
            <div class="step-number">3</div>
            <div class="step-label">Confirmation</div>
        </div>
    </div>

    <div class="reservation-content">
        <div class="reservation-grid">
            <!-- Récapitulatif -->
            <div class="summary-section">
                <h2>📋 Récapitulatif</h2>
                
                <div class="summary-card">
                    <div class="summary-header">
                        <h3>{{ depart.package.titre }}</h3>
                        <span class="depart-date">{{ depart.dateDepart|date('d/m/Y') }}</span>
                    </div>
                    
                    <div class="summary-details">
                        <div class="summary-item">
                            <span class="summary-label">Type de chambre :</span>
                            <span class="summary-value">{{ app.session.get('reservation_data').type_chambre|title }}</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-label">Nombre de pèlerins :</span>
                            <span class="summary-value">{{ nb_pelerins }}</span>
                        </div>
                        
                        <div class="summary-item">
                            <span class="summary-label">Prix par personne :</span>
                            <span class="summary-value">
                                {% if tarif %}
                                    {{ tarif.prixFinal|number_format(0, ',', ' ') }} FCFA
                                {% else %}
                                    {{ depart.package.prixBase|number_format(0, ',', ' ') }} {{ depart.package.devise }}
                                {% endif %}
                            </span>
                        </div>
                        
                        <div class="summary-item total">
                            <span class="summary-label">Total :</span>
                            <span class="summary-value">{{ prix_total|number_format(0, ',', ' ') }} FCFA</span>
                        </div>
                    </div>
                </div>

                <div class="package-info">
                    <h3>📦 Ce qui est inclus :</h3>
                    <ul>
                        <li>✅ Vol aller-retour</li>
                        <li>✅ Hébergement en pension complète</li>
                        <li>✅ Transferts aéroport-hôtel</li>
                        <li>✅ Assistance guide francophone</li>
                        <li>✅ Visa saoudien</li>
                        <li>✅ Assurance voyage</li>
                    </ul>
                </div>
            </div>

            <!-- Formulaire des pèlerins -->
            <div class="pilgrims-form">
                <h2>👥 Informations des pèlerins</h2>
                
                <form method="POST" action="{{ path('app_reservation_step3') }}" class="form">
                    {% for i in 0..nb_pelerins-1 %}
                        <div class="pilgrim-section">
                            <h3>Pèlerin {{ i + 1 }}</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_nom">Nom *</label>
                                    <input type="text" id="pelerin_{{ i }}_nom" name="pelerin_{{ i }}_nom" required class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_prenom">Prénom *</label>
                                    <input type="text" id="pelerin_{{ i }}_prenom" name="pelerin_{{ i }}_prenom" required class="form-control">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_date_naissance">Date de naissance *</label>
                                    <input type="date" id="pelerin_{{ i }}_date_naissance" name="pelerin_{{ i }}_date_naissance" required class="form-control">
                                </div>
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_sexe">Sexe *</label>
                                    <select id="pelerin_{{ i }}_sexe" name="pelerin_{{ i }}_sexe" required class="form-control">
                                        <option value="">Sélectionner</option>
                                        <option value="M">Masculin</option>
                                        <option value="F">Féminin</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="pelerin_{{ i }}_nationalite">Nationalité *</label>
                                <select id="pelerin_{{ i }}_nationalite" name="pelerin_{{ i }}_nationalite" required class="form-control">
                                    <option value="">Sélectionner</option>
                                    <option value="Mali">Mali</option>
                                    <option value="Sénégal">Sénégal</option>
                                    <option value="Côte d'Ivoire">Côte d'Ivoire</option>
                                    <option value="Burkina Faso">Burkina Faso</option>
                                    <option value="Guinée">Guinée</option>
                                    <option value="Niger">Niger</option>
                                    <option value="Tchad">Tchad</option>
                                    <option value="Mauritanie">Mauritanie</option>
                                    <option value="Autre">Autre</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_passport_number">Numéro de passeport</label>
                                    <input type="text" id="pelerin_{{ i }}_passport_number" name="pelerin_{{ i }}_passport_number" class="form-control" placeholder="AB123456">
                                </div>
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_passport_expiry">Date d'expiration du passeport</label>
                                    <input type="date" id="pelerin_{{ i }}_passport_expiry" name="pelerin_{{ i }}_passport_expiry" class="form-control">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_lieu_naissance">Lieu de naissance</label>
                                    <input type="text" id="pelerin_{{ i }}_lieu_naissance" name="pelerin_{{ i }}_lieu_naissance" class="form-control" placeholder="Ville, Pays">
                                </div>
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_phone">Téléphone</label>
                                    <input type="tel" id="pelerin_{{ i }}_phone" name="pelerin_{{ i }}_phone" class="form-control" placeholder="+223 XX XX XX XX">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="pelerin_{{ i }}_adresse">Adresse</label>
                                <textarea id="pelerin_{{ i }}_adresse" name="pelerin_{{ i }}_adresse" rows="2" class="form-control" placeholder="Adresse complète"></textarea>
                            </div>

                            <div class="form-section">
                                <h4>📞 Contact d'urgence</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="pelerin_{{ i }}_nom_urgence">Nom du contact d'urgence</label>
                                        <input type="text" id="pelerin_{{ i }}_nom_urgence" name="pelerin_{{ i }}_nom_urgence" class="form-control" placeholder="Nom complet">
                                    </div>
                                    <div class="form-group">
                                        <label for="pelerin_{{ i }}_phone_urgence">Téléphone d'urgence</label>
                                        <input type="tel" id="pelerin_{{ i }}_phone_urgence" name="pelerin_{{ i }}_phone_urgence" class="form-control" placeholder="+223 XX XX XX XX">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="pelerin_{{ i }}_relation_urgence">Relation avec le contact d'urgence</label>
                                    <select id="pelerin_{{ i }}_relation_urgence" name="pelerin_{{ i }}_relation_urgence" class="form-control">
                                        <option value="">Sélectionner</option>
                                        <option value="Conjoint(e)">Conjoint(e)</option>
                                        <option value="Parent">Parent</option>
                                        <option value="Enfant">Enfant</option>
                                        <option value="Frère/Sœur">Frère/Sœur</option>
                                        <option value="Ami(e)">Ami(e)</option>
                                        <option value="Autre">Autre</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    {% endfor %}

                    <div class="form-actions">
                        <a href="{{ path('app_reservation_step1', {'departId': depart.id}) }}" class="btn btn-secondary">
                            ← Retour
                        </a>
                        <button type="submit" class="btn btn-primary">
                            Continuer → Étape 3
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.reservation-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    border-radius: 1rem;
}

.page-header h1 {
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
}

.page-header p {
    margin: 0;
    font-size: 1.1rem;
    opacity: 0.9;
}

.progress-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
}

.step-number {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: #e9ecef;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.25rem;
}

.progress-step.active .step-number {
    background: var(--color-primary);
    color: white;
}

.progress-step.completed .step-number {
    background: #28a745;
    color: white;
}

.step-label {
    font-size: 0.875rem;
    color: var(--color-gray);
    font-weight: 600;
}

.progress-line {
    width: 4rem;
    height: 2px;
    background: #e9ecef;
    margin: 0 1rem;
}

.reservation-grid {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 3rem;
}

.summary-section h2,
.pilgrims-form h2 {
    margin: 0 0 2rem 0;
    color: var(--color-primary);
    font-size: 1.5rem;
}

.summary-card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-bottom: 2rem;
}

.summary-header {
    background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
    color: white;
    padding: 1.5rem 2rem;
}

.summary-header h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
}

.depart-date {
    font-size: 1rem;
    opacity: 0.9;
}

.summary-details {
    padding: 2rem;
}

.summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f0f0f0;
}

.summary-item:last-child {
    border-bottom: none;
}

.summary-item.total {
    font-weight: 700;
    font-size: 1.1rem;
    color: var(--color-primary);
}

.summary-label {
    color: var(--color-gray);
}

.summary-value {
    color: var(--color-primary);
    font-weight: 500;
}

.package-info {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.package-info h3 {
    margin: 0 0 1rem 0;
    color: var(--color-primary);
}

.package-info ul {
    margin: 0;
    padding-left: 1.5rem;
    color: var(--color-gray);
}

.package-info li {
    margin-bottom: 0.5rem;
}

.pilgrims-form {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.pilgrim-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 0.5rem;
    border-left: 4px solid var(--color-primary);
}

.pilgrim-section h3 {
    margin: 0 0 1.5rem 0;
    color: var(--color-primary);
    font-size: 1.25rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--color-gray);
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 1rem;
    transition: border-color 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1);
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: space-between;
    padding-top: 2rem;
    border-top: 1px solid #f0f0f0;
}

@media (max-width: 768px) {
    .reservation-page {
        padding: 1rem;
    }
    
    .reservation-grid {
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .page-header h1 {
        font-size: 2rem;
    }
    
    .progress-bar {
        flex-direction: column;
        gap: 1rem;
    }
    
    .progress-line {
        width: 2px;
        height: 2rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
}
</style>
{% endblock %} 